# 算法学习期机制设计方案

## 一、问题背景

新接入的广告账号和广告活动通常面临以下数据挑战：

| 数据维度 | 新账号问题 | 影响 |
|----------|------------|------|
| 历史表现数据 | 无或极少 | 无法计算可靠的ROAS/ACoS基准 |
| 转化归因数据 | 不完整 | 7-14天归因窗口导致数据延迟 |
| 时段表现数据 | 缺失 | 无法进行分时预算优化 |
| 关键词表现数据 | 样本量不足 | 无法准确判断关键词价值 |
| 季节性模式 | 未建立 | 无法识别周期性波动 |

如果在数据不充分的情况下直接应用正常的优化算法，可能导致：
- 错误的出价调整（基于噪声数据）
- 过度激进的否词操作（误杀潜力词）
- 不准确的预算分配（缺乏表现基准）

## 二、学习期阶段划分

### 2.1 三阶段模型

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   冷启动期      │ → │    学习期       │ → │    成熟期       │
│  Cold Start     │    │   Learning      │    │    Mature       │
│  (0-7天)        │    │   (8-21天)      │    │    (21天+)      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
     最保守               逐步放开               正常优化
```

### 2.2 各阶段定义

| 阶段 | 时间范围 | 数据要求 | 优化策略 | 风险等级 |
|------|----------|----------|----------|----------|
| **冷启动期** | 0-7天 | 基础数据收集 | 仅监控，极少干预 | 最低风险 |
| **学习期** | 8-21天 | 初步数据积累 | 保守优化，小幅调整 | 低风险 |
| **成熟期** | 21天+ | 数据充分 | 正常优化，全功能 | 正常风险 |

## 三、数据充分性评估标准

### 3.1 核心指标阈值

系统通过以下指标评估数据是否充分：

| 指标 | 冷启动期阈值 | 学习期阈值 | 成熟期阈值 | 权重 |
|------|--------------|------------|------------|------|
| **数据天数** | <7天 | 7-21天 | ≥21天 | 30% |
| **总点击数** | <100 | 100-500 | ≥500 | 25% |
| **总转化数** | <10 | 10-50 | ≥50 | 25% |
| **活跃关键词数** | <20 | 20-100 | ≥100 | 10% |
| **数据连续性** | <50% | 50-80% | ≥80% | 10% |

### 3.2 数据充分性评分公式

```
数据充分性评分 = Σ(各指标达成率 × 权重)

其中：
- 指标达成率 = MIN(实际值 / 成熟期阈值, 1.0)
- 评分范围：0-100分
- 阶段判定：
  - 0-30分 → 冷启动期
  - 31-70分 → 学习期
  - 71-100分 → 成熟期
```

### 3.3 特殊情况处理

| 情况 | 处理方式 |
|------|----------|
| 数据断档（连续3天无数据） | 重置学习期计时 |
| 大促期间接入 | 延长学习期至大促结束后7天 |
| 账号迁移（有历史数据） | 可跳过冷启动期 |
| 季节性品类 | 需要完整季节周期数据 |

## 四、各阶段优化策略

### 4.1 冷启动期策略（0-7天）

**核心原则：观察为主，极少干预**

| 功能模块 | 策略 | 说明 |
|----------|------|------|
| **预算控制** | 禁用自动调整 | 仅监控消耗速度，不做调整 |
| **竞价控制** | 禁用自动调整 | 收集CPC基准数据 |
| **位置倾向** | 禁用自动调整 | 收集位置表现数据 |
| **分时预算** | 使用默认权重 | 不基于历史数据调整 |
| **N-Gram否词** | 仅分析，不建议 | 数据量不足，避免误判 |
| **流量迁移** | 完全禁用 | 等待数据积累 |
| **健康度监控** | 仅极端异常告警 | 阈值放宽3倍 |

**安全边界调整：**
```
预算调整幅度：±0%（禁用）
竞价调整幅度：±0%（禁用）
位置调整幅度：±0%（禁用）
```

### 4.2 学习期策略（8-21天）

**核心原则：保守优化，小幅调整**

| 功能模块 | 策略 | 说明 |
|----------|------|------|
| **预算控制** | 启用，幅度减半 | 最大±12.5%（正常±25%） |
| **竞价控制** | 启用，幅度减半 | 最大±5%（正常±10%） |
| **位置倾向** | 启用，幅度减半 | 最大±12.5%（正常±25%） |
| **分时预算** | 启用，系数衰减 | 调整幅度×0.5 |
| **N-Gram否词** | 启用，阈值加倍 | 频率≥50次，花费≥$25 |
| **流量迁移** | 启用，仅高置信度 | 置信度≥90%才建议 |
| **健康度监控** | 正常告警 | 阈值放宽1.5倍 |

**安全边界调整：**
```
预算调整幅度：±12.5%（正常的50%）
竞价调整幅度：±5%（正常的50%）
位置调整幅度：±12.5%（正常的50%），上限200%
```

**学习期进度因子：**
```
进度因子 = (当前天数 - 7) / 14
调整幅度 = 基础幅度 × (0.5 + 0.5 × 进度因子)

示例：
- 第8天：进度因子=0.07，调整幅度=53.5%
- 第14天：进度因子=0.5，调整幅度=75%
- 第21天：进度因子=1.0，调整幅度=100%
```

### 4.3 成熟期策略（21天+）

**核心原则：正常优化，全功能启用**

| 功能模块 | 策略 | 说明 |
|----------|------|------|
| **预算控制** | 全功能启用 | 最大±25% |
| **竞价控制** | 全功能启用 | 最大±10% |
| **位置倾向** | 全功能启用 | 最大±25%，上限200% |
| **分时预算** | 全功能启用 | 基于历史数据优化 |
| **N-Gram否词** | 全功能启用 | 频率≥25次，花费≥$12.5 |
| **流量迁移** | 全功能启用 | 置信度≥70%即可建议 |
| **健康度监控** | 全功能启用 | 正常阈值 |

**安全边界：**
```
预算调整幅度：±25%
竞价调整幅度：±10%
位置调整幅度：±25%，上限200%
```

## 五、学习期进度指示器

### 5.1 UI展示设计

```
┌────────────────────────────────────────────────────────────┐
│  📊 算法学习进度                                            │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  当前阶段: 学习期 (第12天/共21天)                           │
│                                                            │
│  ████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  57%           │
│  冷启动期        学习期              成熟期                 │
│                    ↑                                       │
│                  当前位置                                   │
│                                                            │
│  数据充分性评分: 62/100                                     │
│  ┌──────────────────────────────────────────────────┐      │
│  │ ✓ 数据天数: 12天 (目标21天)           57%        │      │
│  │ ✓ 总点击数: 320次 (目标500次)         64%        │      │
│  │ ○ 总转化数: 28次 (目标50次)           56%        │      │
│  │ ✓ 活跃关键词: 85个 (目标100个)        85%        │      │
│  │ ✓ 数据连续性: 92% (目标80%)          100%        │      │
│  └──────────────────────────────────────────────────┘      │
│                                                            │
│  当前优化能力:                                              │
│  ┌──────────────────────────────────────────────────┐      │
│  │ 预算调整: ±15% (成熟期±25%)                      │      │
│  │ 竞价调整: ±6% (成熟期±10%)                       │      │
│  │ N-Gram否词: 已启用 (阈值加倍)                    │      │
│  │ 流量迁移: 已启用 (仅高置信度)                    │      │
│  └──────────────────────────────────────────────────┘      │
│                                                            │
│  预计进入成熟期: 2026-01-16 (还需9天)                       │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

### 5.2 阶段转换通知

| 转换事件 | 通知内容 |
|----------|----------|
| 进入学习期 | "恭喜！您的广告账号已完成冷启动，进入学习期。系统将开始进行保守优化。" |
| 进入成熟期 | "恭喜！您的广告账号数据已充分，进入成熟期。系统将启用全部优化功能。" |
| 学习期延长 | "由于数据断档/大促期间，学习期已延长至 [日期]。" |
| 数据不足警告 | "近期数据量下降，可能影响优化效果。请检查广告活动状态。" |

## 六、实现架构

### 6.1 数据库表结构

```sql
-- 优化目标学习状态表
CREATE TABLE optimization_target_learning_status (
  id INT AUTO_INCREMENT PRIMARY KEY,
  performance_group_id INT NOT NULL,
  account_id INT NOT NULL,
  
  -- 阶段信息
  current_stage ENUM('cold_start', 'learning', 'mature') DEFAULT 'cold_start',
  stage_start_date TIMESTAMP NOT NULL,
  expected_mature_date TIMESTAMP,
  
  -- 数据充分性评分
  data_sufficiency_score DECIMAL(5,2) DEFAULT 0,
  data_days INT DEFAULT 0,
  total_clicks INT DEFAULT 0,
  total_conversions INT DEFAULT 0,
  active_keywords INT DEFAULT 0,
  data_continuity DECIMAL(5,2) DEFAULT 0,
  
  -- 学习期调整因子
  adjustment_factor DECIMAL(5,4) DEFAULT 0.5,
  
  -- 特殊状态
  is_paused BOOLEAN DEFAULT FALSE,
  pause_reason VARCHAR(255),
  
  -- 时间戳
  last_evaluated_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  UNIQUE KEY (performance_group_id),
  INDEX (account_id),
  INDEX (current_stage)
);

-- 学习期历史记录表
CREATE TABLE learning_stage_history (
  id INT AUTO_INCREMENT PRIMARY KEY,
  performance_group_id INT NOT NULL,
  from_stage ENUM('cold_start', 'learning', 'mature'),
  to_stage ENUM('cold_start', 'learning', 'mature') NOT NULL,
  transition_reason VARCHAR(255),
  data_sufficiency_score DECIMAL(5,2),
  transitioned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX (performance_group_id),
  INDEX (transitioned_at)
);
```

### 6.2 核心算法流程

```
┌─────────────────────────────────────────────────────────────┐
│                    学习期评估流程                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 数据收集                                                │
│     ├── 获取优化目标关联的所有广告活动                       │
│     ├── 统计数据天数、点击数、转化数                         │
│     ├── 统计活跃关键词数                                    │
│     └── 计算数据连续性                                      │
│                                                             │
│  2. 充分性评分                                              │
│     ├── 计算各指标达成率                                    │
│     ├── 应用权重计算总分                                    │
│     └── 判定当前阶段                                        │
│                                                             │
│  3. 调整因子计算                                            │
│     ├── 冷启动期: factor = 0                                │
│     ├── 学习期: factor = 0.5 + 0.5 × progress              │
│     └── 成熟期: factor = 1.0                                │
│                                                             │
│  4. 应用调整因子                                            │
│     ├── 预算调整幅度 = 基础幅度 × factor                    │
│     ├── 竞价调整幅度 = 基础幅度 × factor                    │
│     ├── N-Gram阈值 = 基础阈值 / factor                      │
│     └── 迁移置信度阈值 = 基础阈值 + (1-factor) × 20%        │
│                                                             │
│  5. 记录和通知                                              │
│     ├── 更新学习状态表                                      │
│     ├── 记录阶段转换历史                                    │
│     └── 发送阶段转换通知                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 七、与现有算法的集成

### 7.1 安全边界模块集成

```typescript
// 获取调整后的安全边界
function getAdjustedSafetyLimits(learningStatus: LearningStatus) {
  const factor = learningStatus.adjustmentFactor;
  
  return {
    budget: {
      maxIncrease: SAFETY_LIMITS.BUDGET.MAX_INCREASE_PERCENT * factor,
      maxDecrease: SAFETY_LIMITS.BUDGET.MAX_DECREASE_PERCENT * factor,
    },
    bid: {
      maxIncrease: SAFETY_LIMITS.BID.MAX_INCREASE_PERCENT * factor,
      maxDecrease: SAFETY_LIMITS.BID.MAX_DECREASE_PERCENT * factor,
    },
    placement: {
      maxIncrease: SAFETY_LIMITS.PLACEMENT.MAX_INCREASE_PERCENT * factor,
      maxDecrease: SAFETY_LIMITS.PLACEMENT.MAX_DECREASE_PERCENT * factor,
      absoluteMax: SAFETY_LIMITS.PLACEMENT.ABSOLUTE_MAX,
    },
  };
}
```

### 7.2 N-Gram分析集成

```typescript
// 获取调整后的N-Gram阈值
function getAdjustedNgramThresholds(learningStatus: LearningStatus) {
  const factor = Math.max(learningStatus.adjustmentFactor, 0.5);
  
  return {
    minFrequency: Math.ceil(NGRAM_THRESHOLDS.MIN_FREQUENCY / factor),
    minSpend: NGRAM_THRESHOLDS.MIN_SPEND / factor,
  };
}
```

### 7.3 流量迁移集成

```typescript
// 获取调整后的迁移置信度阈值
function getAdjustedMigrationThreshold(learningStatus: LearningStatus) {
  const factor = learningStatus.adjustmentFactor;
  const baseThreshold = 0.7; // 70%
  
  // 学习期要求更高的置信度
  return baseThreshold + (1 - factor) * 0.2; // 最高90%
}
```

## 八、待确认事项

1. **阶段时间范围**：冷启动期7天、学习期14天是否合适？是否需要根据品类调整？

2. **数据阈值**：各指标的阈值（点击数500、转化数50等）是否符合实际业务场景？

3. **调整因子曲线**：线性增长还是需要其他曲线（如S曲线）？

4. **特殊情况处理**：
   - 大促期间接入的账号如何处理？
   - 季节性品类是否需要更长的学习期？
   - 已有历史数据的账号迁移如何处理？

5. **UI展示**：学习期进度指示器的展示位置和样式是否合适？

---

**文档版本**: v1.0  
**创建日期**: 2026-01-07  
**作者**: Manus AI
